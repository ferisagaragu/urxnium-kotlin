!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common/http"),require("@angular/core"),require("rxjs"),require("sweetalert2"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ng-urxnium",["exports","@angular/common/http","@angular/core","rxjs","sweetalert2","rxjs/operators"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["ng-urxnium"]={},e.ng.common.http,e.ng.core,e.rxjs,e.Swal,e.rxjs.operators)}(this,(function(e,t,n,o,r,i){"use strict";function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=a(r),c=function(){function e(){}return Object.defineProperty(e.prototype,"headers",{get:function(){return(new t.HttpHeaders).set("Authorization","Bearer "+this.getToken())},enumerable:!1,configurable:!0}),e.prototype.getToken=function(){return localStorage.getItem("token")},e}(),u=function(){function e(){}return e.prototype.open=function(e,t){return new o.Observable((function(n){var o=0,r=window.open(e,"targetWindow","toolbar=no,\n        location=center,\n        status=no,\n        menubar=no,\n        scrollbars=no,\n        resizable=no,\n        width=400,\n        height=600,\n        "+(t?"screenX="+t.screenX:"")+",\n        "+(t?"screenY="+t.screenY:"")),i=setInterval((function(){try{var e=r.location.href;void 0!==e&&e.toString().includes("http")&&(r.close(),clearInterval(i),n.next(e.split("?code=")[1]))}catch(e){}10===o&&(clearInterval(i),n.error()),o++}),1e3)}))},e}();u.ɵfac=function(e){return new(e||u)},u.ɵprov=n.ɵɵdefineInjectable({token:u,factory:u.ɵfac,providedIn:"root"});var f=function(){function e(){}return e.prototype.fire=function(e){var t=null,n=e.confirmButtonColor,r=e.cancelButtonColor;return s.default.fire(Object.assign(Object.assign({},e),{allowOutsideClick:!1,confirmButtonColor:n||"#00d1b2",cancelButtonColor:r||"#F44336",reverseButtons:!0,closeButtonHtml:'<button class="mat-focus-indicator mr-2 mat-stroked-button mat-button-base mat-accent">Cancelar</button>'})).then((function(e){t&&t.next(e.isConfirmed)})),new o.Observable((function(e){return t=e}))},e}();f.ɵfac=function(e){return new(e||f)},f.ɵprov=n.ɵɵdefineInjectable({token:f,factory:f.ɵfac,providedIn:"root"});var l=function(){function e(e,t){this.http=e,this.baseUrl=t,this.onSignIn=new o.BehaviorSubject(!1),this.count=!0,this.firstSignIn=!1,this.user=JSON.parse(localStorage.getItem("user"))}return e.prototype.signIn=function(e,t){localStorage.setItem("token",e.token),localStorage.setItem("expiration",e.expiration.toString()),localStorage.setItem("expirationDate",e.expirationDate.toString()),localStorage.setItem("refreshToken",e.refreshToken),localStorage.setItem("user",JSON.stringify(t)),this.user=t,this.onSignIn.next(!0),this.firstSignIn=!0},e.prototype.signOut=function(){localStorage.clear(),this.onSignIn.next(!1),this.firstSignIn=!1,clearTimeout(this.timeOut)},e.prototype.checkSession=function(){var e=this;return new o.Observable((function(t){e.firstSignIn?e.setSignIn(null,t):localStorage.getItem("token")&&localStorage.getItem("expiration")&&localStorage.getItem("expirationDate")&&localStorage.getItem("refreshToken")&&localStorage.getItem("user")&&!e.firstSignIn?e.validateToken().subscribe((function(n){e.setSignIn(n,t)}),(function(n){e.refreshToken().subscribe((function(n){e.setSignIn(n,t)}),(function(n){e.setSignOut(t)}))})):e.setSignOut(t)}))},e.prototype.getUser=function(){return this.user},e.prototype.validateToken=function(){var e=this;return this.http.get(this.baseUrl+"/auth/validate-token",{headers:this.headers}).pipe(i.map((function(t){var n=t.data.session;return delete t.data.session,e.user=t.data,localStorage.setItem("user",JSON.stringify(t.data)),n})))},e.prototype.refreshToken=function(){return this.http.post(this.baseUrl+"/auth/refresh-token",{refreshToken:localStorage.getItem("refreshToken")}).pipe(i.map((function(e){return e.data})))},e.prototype.refreshSession=function(){var e=this;this.count&&(this.count=!1,this.timeOut=setTimeout((function(){e.refreshToken().subscribe((function(t){localStorage.setItem("token",t.token),localStorage.setItem("expiration",t.expiration.toString()),localStorage.setItem("expirationDate",t.expirationDate.toString()),e.count=!0,e.refreshSession()}),(function(t){e.signOut()}))}),localStorage.getItem("expiration")))},e.prototype.setSignIn=function(e,t){e&&(localStorage.setItem("token",e.token),localStorage.setItem("expiration",e.expiration.toString()),localStorage.setItem("expirationDate",e.expirationDate.toString())),this.refreshSession(),this.onSignIn.next(!0),t.next(!0)},e.prototype.setSignOut=function(e){this.signOut(),e.next(!1)},Object.defineProperty(e.prototype,"headers",{get:function(){return(new t.HttpHeaders).set("Authorization","Bearer "+localStorage.getItem("token"))},enumerable:!1,configurable:!0}),e}();l.ɵfac=function(e){return new(e||l)(n.ɵɵinject(t.HttpClient),n.ɵɵinject("baseUrl"))},l.ɵprov=n.ɵɵdefineInjectable({token:l,factory:l.ɵfac,providedIn:"root"});var p=function(){function e(e){this.http=e}return e.prototype.canActivate=function(e,t){return this.user=sessionStorage.getItem("user"),this.token=sessionStorage.getItem("token"),this.refreshToken=sessionStorage.getItem("refreshToken"),new o.Observable((function(e){console.log("aqui va toda la programacion externa")}))},e.prototype.containsRefreshTokenUrl=function(e,t){return!!e.data.validateTokenUrl||(t.next(!1),!1)},e.prototype.checkSessionData=function(e){var t=this;this.user&&this.refreshToken&&this.token?this.http.get("valid token").subscribe((function(t){e.next(!0)}),(function(n){t.http.get("").subscribe((function(n){t.refreshTokenAtClock(),e.next(!0)}),(function(t){sessionStorage.clear(),e.next(!1)}))})):e.next(!1)},e.prototype.refreshTokenAtClock=function(){},e}();p.ɵfac=function(e){return new(e||p)(n.ɵɵinject(t.HttpClient))},p.ɵprov=n.ɵɵdefineInjectable({token:p,factory:p.ɵfac,providedIn:"root"});var g=function(){};g.ɵfac=function(e){return new(e||g)},g.ɵprov=n.ɵɵdefineInjectable({token:g,factory:g.ɵfac,providedIn:"root"});var h=function(){function e(){}return e.prototype.ngOnInit=function(){},e}();h.ɵfac=function(e){return new(e||h)},h.ɵcmp=n.ɵɵdefineComponent({type:h,selectors:[["lib-ng-urxnium"]],decls:2,vars:0,template:function(e,t){1&e&&(n.ɵɵelementStart(0,"p"),n.ɵɵtext(1," ng-urxnium works! "),n.ɵɵelementEnd())},encapsulation:2});var d=function(){};d.ɵmod=n.ɵɵdefineNgModule({type:d}),d.ɵinj=n.ɵɵdefineInjector({factory:function(e){return new(e||d)},imports:[[]]}),("undefined"==typeof ngJitMode||ngJitMode)&&n.ɵɵsetNgModuleScope(d,{declarations:[h],exports:[h]}),e.AuthenticationGuard=p,e.HttpService=c,e.NgUrxniumComponent=h,e.NgUrxniumModule=d,e.NgUrxniumService=g,e.SessionService=l,e.SignInWindowService=u,e.SweetAlert2Service=f,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-urxnium.umd.min.js.map